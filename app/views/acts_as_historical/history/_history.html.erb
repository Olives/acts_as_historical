<tr>
  <td><%= time_ago_in_words history.created_at %> ago</td>
  <td>
    <% if @by == "model" %>
      <%= history.display_label(:editor) %>
    <% else %>
      <%= history.display_label(:model) %>
    <% end %>
  </td>
  <td>
    <dl>
      <% if history.before.empty? %>
        <dt><strong><%= t "acts_as_historical.created" %></strong> </dt>
      <% elsif history.after.empty? %>
        <dt><strong><%= t "acts_as_historical.deleted" %></strong> </dt>
      <% end %>
      <% if history.item_type != history.historical_type %>
        <dt><%= history.display_label(:dependent) %></dt>
      <% end %>

      <% options = history.after_model.history_options %>
      <% History.remove_unwanted_fields(options,  history.after.dup).each do |field, value| %>
        <% unless field == :id || history.before[field] == value ||
               (options[:display][field.intern] && history.after_model.send(options[:display][field.intern]).nil?) %>

          <dt class="indent"><%= field.to_s.humanize %> </dt>
          <dd>
            <% if history.before.key? field %>
              <div><%= t "acts_as_historical.old_value", :value => history.before_model.send(field) %></div>
            <% end %>
            <div>
              <%= t "acts_as_historical.new_value", :value => history.after_model.send(field) %>
            </div>
          </dd>
        <% end %>
    <% end %>
    </dl>
  </td>
</tr>
